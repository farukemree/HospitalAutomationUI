<div class="container">
  <div class="container mt-4">
  <h2>🧠 Hastalık Tahmini</h2>
  <div class="mb-3">
    <label for="symptomInput" class="form-label">Semptomlarınızı girin:</label>
    <input type="text" class="form-control" id="symptomInput" [(ngModel)]="symptomInput" placeholder="Örnek: nefes darlığı, öksürük, hırıltı" />
  </div>
  <button class="btn btn-primary mb-3" (click)="predictDisease()">Tahmin Et</button>

  <div *ngIf="predictedDisease" class="alert alert-info">
    ✅ Tahmin Edilen Hastalık: <strong>{{ predictedDisease }}</strong>
  </div>
    <div class="mt-4 mb-4">
    <h4>💬 Yapay Zeka Destekli Sağlık Asistanı</h4>
    <app-chatbox></app-chatbox>
  </div>
</div>
  <!-- Doktor Listesi -->
  <section class="doctor-list mb-5 card-section">
    <h2 class="section-title">Doktor Listesi</h2>

    <ul *ngIf="doctors.length > 0; else noDoctors" class="list-group">
      <li *ngFor="let doctor of doctors" class="list-group-item d-flex justify-content-between align-items-center doctor-item">
        <div class="doctor-info d-flex align-items-center gap-3">
          <img 
            [src]="doctor.imageUrl" 
            alt="Doktor Fotoğrafı" 
            class="doctor-img"
            onerror="this.src='assets/default-doctor.png'" />
          <div>
            <strong>{{ doctor.fullName }}</strong> <br>
            <small class="text-muted">{{ doctor.specialization }}</small>
          </div>
        </div>
        <span class="badge badge-info badge-pill">📞 {{ doctor.phone }}</span>
      </li>
    </ul>

    <ng-template #noDoctors>
      <p class="text-warning text-center mt-3">Henüz doktor listesi yüklenmedi veya boş.</p>
    </ng-template>
  </section>

  <hr>

  <!-- Randevu Oluştur / Güncelle -->
  <section class="appointment-create mb-5 card-section">
    <h2 class="section-title">{{ editingAppointment ? 'Randevuyu Güncelle' : 'Randevu Oluştur' }}</h2>
    <form (ngSubmit)="onSubmit()" #appointmentForm="ngForm" class="form">

      <div class="form-group mb-3">
        <label for="doctor">Doktor Seç:</label>
       <!-- Doktor seçimi isme göre -->
<select class="form-select" [(ngModel)]="selectedDoctorName" name="doctorName" (change)="onDoctorNameChange()" required>
  <option value="" disabled selected>Doktor seçin</option>
  <option *ngFor="let doc of doctors" 
          [value]="doc.fullName"
          [disabled]="isDoctorAlreadyBooked(doc.id)">
    {{ doc.fullName }} 
  </option>
</select>


      </div>

   <!-- Tarih seçimi -->
<div class="form-group mb-3">
  <label for="date">Randevu Tarihi:</label>
  <input
    class="form-control"
    type="date"
    [(ngModel)]="selectedDate"
    name="selectedDate"
    (change)="onDateChange()"
    required
  />
</div>

 <!-- Saat Seçimi -->
<div class="form-group mb-3">
  <label for="timeSlot">Randevu Saati:</label>
  <select
    class="form-control"
    [(ngModel)]="selectedTime"
    name="selectedTime"
    required
  >
    <option *ngFor="let slot of availableTimeSlots"
            [value]="slot.time"
            [disabled]="slot.disabled">
      {{ slot.time }} {{ slot.disabled ? '(Dolu)' : '' }}
    </option>
  </select>
</div>


<div class="form-group mb-4">
  <label for="description">Açıklama:</label>
  <textarea
    class="form-control"
    id="description"
    [(ngModel)]="appointment.description"
    name="description"
    rows="3"
    placeholder="Şikayetinizi veya açıklamanızı girin..."
  ></textarea>
</div>


      <button type="submit" class="btn btn-success w-100">
        {{ editingAppointment ? 'Güncelle' : 'Oluştur' }}
      </button>
    </form>
  </section>

  <hr>

  <!-- Randevularım -->
  <section class="my-appointments mb-5 card-section">
    <h2 class="section-title">Randevularım</h2>
   

    <ul *ngIf="appointments.length > 0; else noAppointments" class="list-group">
      <li *ngFor="let app of appointments" class="list-group-item d-flex justify-content-between align-items-center appointment-item">
        <div>
          <strong>📅 Tarih:</strong> {{ app.appointmentDate | date:'short' }} <br>
          <strong>👨‍⚕️ Doktor:</strong> {{ app.doctorName }} <br>
          <strong>📝 Açıklama:</strong> {{ app.description || '-' }}
        </div>
        <div class="btn-group">
          <button class="btn btn-sm btn-warning me-2" (click)="startEditAppointment(app)">Düzenle</button>
          <button class="btn btn-sm btn-danger" (click)="deleteAppointment(app.id!)">Sil</button>
        </div>
      </li>
    </ul>

    <ng-template #noAppointments>
      <p class="text-muted text-center mt-3">Henüz randevunuz yok veya henüz yüklenmedi .</p>
    </ng-template>
  </section>

  <hr>

  <<section class="medical-records card-section">
  <h2 class="section-title">Tıbbi Kayıtlarım</h2>

  <ul *ngIf="medicalRecords.length > 0; else noMedicalRecords" class="list-group">
    <li *ngFor="let record of medicalRecords" class="list-group-item medical-record-item">
      <div>
        <strong>📅 Tarih:</strong> {{ record.recordDate | date:'short' }} <br>
        <strong>📝 Tanı:</strong> {{ getDiagnosis(record.description) }}
      </div>
    </li>
  </ul>

  <ng-template #noMedicalRecords>
    <p class="text-muted text-center mt-3">Henüz tıbbi kayıt bulunmamaktadır.</p>
  </ng-template>
</section>



</div>
